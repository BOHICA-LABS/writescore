name: Stale Issues and PRs

on:
  schedule:
    - cron: '0 9 * * *'  # Run daily at 9am UTC
  workflow_dispatch:  # Allow manual trigger

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - name: Mark stale issues and PRs
        uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}

          # Timing
          days-before-stale: 60
          days-before-close: 14

          # Issue settings
          stale-issue-label: 'stale'
          stale-issue-message: |
            This issue has been automatically marked as stale because it has not had recent activity.
            It will be closed in 14 days if no further activity occurs.

            If this issue is still relevant:
            - Comment with an update or ping a maintainer
            - Add the `priority: high` label to prevent auto-closing

            Thank you for your contributions!
          close-issue-message: |
            This issue has been automatically closed due to inactivity.
            Feel free to reopen if the issue is still relevant.

          # PR settings
          stale-pr-label: 'stale'
          stale-pr-message: |
            This pull request has been automatically marked as stale because it has not had recent activity.
            It will be closed in 14 days if no further activity occurs.

            If this PR is still in progress:
            - Push new commits or comment with an update
            - Request a review from a maintainer
          close-pr-message: |
            This pull request has been automatically closed due to inactivity.
            Feel free to reopen when ready to continue.

          # Exempt labels - these issues/PRs won't be marked stale
          exempt-issue-labels: 'priority: high,scope: epic,scope: story'
          exempt-pr-labels: 'priority: high'

          # Don't close issues/PRs with these labels
          exempt-all-milestones: true

          # Operations per run (to avoid rate limits)
          operations-per-run: 50
